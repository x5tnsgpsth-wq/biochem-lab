<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioChem Professional Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'IBM Plex Sans Arabic', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            user-select: none;
        }

        .lab-bench {
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            background-size: cover;
        }

        /* Test Tube Styling */
        .tube-holder {
            width: 120px;
            height: 350px;
            position: relative;
            filter: drop-shadow(0 20px 30px rgba(0,0,0,0.5));
        }

        .glass-tube {
            width: 80px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            position: relative;
            margin: 0 auto;
            overflow: hidden;
            z-index: 10;
        }

        .glass-tube::before {
            content: '';
            position: absolute;
            top: 0; left: 15%;
            width: 15%; height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0.15), transparent);
        }

        .liquid-layer {
            position: absolute;
            bottom: 0;
            width: 100%;
            transition: all 2s ease-in-out;
        }

        /* Specific Test Effects */
        .molisch-ring {
            position: absolute;
            bottom: 40%;
            width: 100%;
            height: 10px;
            background: rgba(147, 51, 234, 0.8);
            filter: blur(4px);
            opacity: 0;
            transition: opacity 2s;
            z-index: 35;
        }

        .bubbles {
            position: absolute;
            bottom: 10px;
            width: 100%;
            display: none;
        }

        @keyframes rise {
            0% { transform: translateY(0); opacity: 0.8; }
            100% { transform: translateY(-200px); opacity: 0; }
        }

        .bubble {
            position: absolute;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            animation: rise 1.5s infinite;
        }

        .burner-active .flame {
            display: block;
        }

        .flame {
            display: none;
            width: 30px;
            height: 60px;
            background: radial-gradient(circle at bottom, #60a5fa, #2563eb, transparent);
            border-radius: 50% 50% 20% 20%;
            filter: blur(5px);
            animation: flicker 0.1s infinite alternate;
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
        }

        @keyframes flicker {
            0% { transform: translateX(-50%) scale(1); }
            100% { transform: translateX(-50%) scale(1.1); opacity: 0.8; }
        }

        /* Tooltip-like Info */
        .info-card {
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }

        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Top Bar -->
    <nav class="h-16 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-8 shrink-0 shadow-2xl z-50">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-emerald-600 rounded-lg flex items-center justify-center shadow-lg shadow-emerald-900/20">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.642.257a4 4 0 01-1.536.303H10a2 2 0 01-2-2V8a2 2 0 012-2h.341a4 4 0 011.536.303l.642.257a6 6 0 003.86.517l2.387-.477a2 2 0 001.022-.547l.54-.54a2 2 0 012.829 0l1.414 1.414a2 2 0 010 2.829l-.54.54z"></path></svg>
            </div>
            <div>
                <h1 class="text-sm font-bold text-slate-100">Virtual BioChem Lab</h1>
                <p class="text-[10px] text-emerald-500 font-mono tracking-tighter uppercase">Professional Simulator v2.1</p>
            </div>
        </div>
        
        <div class="flex items-center gap-6">
            <div id="status-display" class="flex items-center gap-2 px-4 py-2 bg-slate-800 rounded-full border border-slate-700">
                <div class="w-2 h-2 rounded-full bg-slate-500 animate-pulse"></div>
                <span class="text-[10px] text-slate-400 font-medium">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©: Ø¬Ø§Ù‡Ø²</span>
            </div>
            <button onclick="resetLab()" class="text-[11px] font-semibold text-slate-400 hover:text-white transition-colors">Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø¹Ù…Ù„</button>
        </div>
    </nav>

    <div class="flex-1 flex overflow-hidden">
        
        <!-- Inventory Sidebar -->
        <aside class="w-80 bg-slate-900/50 border-l border-slate-800 p-6 flex flex-col gap-8 custom-scroll overflow-y-auto">
            
            <section>
                <header class="flex items-center gap-2 mb-4">
                    <span class="w-1 h-4 bg-emerald-500 rounded-full"></span>
                    <h2 class="text-[11px] font-bold text-slate-400 uppercase tracking-widest">Ø§Ù„Ø¹ÙŠÙ†Ø§Øª Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§ØªÙŠØ©</h2>
                </header>
                <div id="samples-grid" class="grid gap-2">
                    <!-- Dynamic Content -->
                </div>
            </section>

            <section>
                <header class="flex items-center gap-2 mb-4">
                    <span class="w-1 h-4 bg-blue-500 rounded-full"></span>
                    <h2 class="text-[11px] font-bold text-slate-400 uppercase tracking-widest">Ø§Ù„ÙƒÙˆØ§Ø´Ù Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ©</h2>
                </header>
                <div id="reagents-grid" class="grid gap-2">
                    <!-- Dynamic Content -->
                </div>
            </section>

            <section>
                <header class="flex items-center gap-2 mb-4">
                    <span class="w-1 h-4 bg-red-500 rounded-full"></span>
                    <h2 class="text-[11px] font-bold text-slate-400 uppercase tracking-widest">Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©</h2>
                </header>
                <div class="space-y-2">
                    <button onclick="applyHeat()" class="w-full py-3 bg-red-500/10 border border-red-500/20 hover:bg-red-500/20 rounded-xl transition-all flex items-center justify-between px-4 group">
                        <span class="text-xs font-semibold text-red-400">ØªØ³Ø®ÙŠÙ† (Water Bath)</span>
                        <span class="text-lg group-hover:animate-bounce">ğŸ”¥</span>
                    </button>
                    <button id="hydrolysis-btn" onclick="startHydrolysis()" class="w-full py-3 bg-blue-500/10 border border-blue-500/20 hover:bg-blue-500/20 rounded-xl transition-all flex items-center justify-between px-4 group disabled:opacity-30">
                        <span class="text-xs font-semibold text-blue-400">ØªØ­Ù„Ù„ Ù…Ø§Ø¦ÙŠ (Hâ‚‚O/Hâº)</span>
                        <span class="text-lg">ğŸ§ª</span>
                    </button>
                </div>
            </section>

        </aside>

        <!-- Main Workspace -->
        <main class="flex-1 lab-bench relative flex flex-col items-center justify-center p-12">
            
            <!-- Real-time Instruction -->
            <div class="absolute top-10 left-1/2 -translate-x-1/2 w-[500px] text-center">
                <div id="instruction-box" class="bg-black/40 backdrop-blur-md border border-white/5 p-4 rounded-2xl shadow-2xl transition-all">
                    <p id="instruction-text" class="text-sm text-slate-300">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù…Ø®ØªØ¨Ø±. Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø¹ÙŠÙ†Ø© Ù„ÙˆØ¶Ø¹Ù‡Ø§ ÙÙŠ Ø£Ù†Ø¨ÙˆØ¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±.</p>
                </div>
            </div>

            <!-- The Bench -->
            <div class="relative flex flex-col items-center">
                <!-- Tube Holder -->
                <div class="tube-holder flex flex-col items-center">
                    <div id="tube" class="glass-tube">
                        <!-- Liquid Layers -->
                        <div id="layer-sample" class="liquid-layer bg-slate-400/20 h-0 z-10"></div>
                        <div id="layer-reagent" class="liquid-layer bg-transparent h-0 z-20"></div>
                        <div id="layer-reaction" class="liquid-layer bg-transparent h-0 z-30"></div>
                        <div id="molisch-ring" class="molisch-ring"></div>
                        
                        <!-- Bubbles -->
                        <div id="bubble-container" class="bubbles"></div>
                    </div>
                    
                    <!-- Label -->
                    <div id="tube-label" class="mt-6 px-4 py-1 bg-slate-800 border border-slate-700 rounded text-[10px] font-mono text-slate-400 opacity-0 transition-opacity uppercase tracking-tighter">EMPTY</div>
                </div>

                <!-- Burner Device -->
                <div id="burner-device" class="mt-8 relative">
                    <div class="flame"></div>
                    <div class="w-20 h-10 bg-gradient-to-b from-slate-700 to-slate-900 rounded-t-xl border-t border-slate-600"></div>
                </div>
            </div>

            <!-- Result Panel (Floating) -->
            <div id="result-panel" class="absolute bottom-10 right-10 w-96 info-card rounded-3xl p-6 transform translate-y-full opacity-0 transition-all duration-700 overflow-hidden">
                <div class="relative z-10">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹ÙŠÙ†Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h3>
                        <span id="res-badge" class="px-2 py-0.5 rounded text-[9px] font-bold"></span>
                    </div>
                    <h2 id="res-title" class="text-xl font-bold text-white mb-2"></h2>
                    <p id="res-desc" class="text-xs text-slate-400 leading-relaxed mb-4"></p>
                    <div class="grid grid-cols-2 gap-2">
                        <div class="p-3 bg-white/5 rounded-2xl border border-white/5">
                            <span class="block text-[8px] text-slate-500 uppercase mb-1">Ø§Ù„ØªØ±ÙƒÙŠØ¨ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ</span>
                            <span id="res-struct" class="text-[10px] text-blue-400 font-mono"></span>
                        </div>
                        <div class="p-3 bg-white/5 rounded-2xl border border-white/5">
                            <span class="block text-[8px] text-slate-500 uppercase mb-1">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ù…Ø®Ø¨Ø±ÙŠØ©</span>
                            <span id="res-obs" class="text-[10px] text-emerald-400 font-medium"></span>
                        </div>
                    </div>
                </div>
                <!-- Background Decoration -->
                <div class="absolute top-0 right-0 -m-4 w-24 h-24 bg-blue-600/10 rounded-full blur-3xl"></div>
            </div>

        </main>

        <!-- Academic Log Sidebar -->
        <aside class="w-80 bg-slate-900/50 border-r border-slate-800 p-6 flex flex-col shadow-inner">
            <header class="flex items-center justify-between mb-6">
                <h2 class="text-[11px] font-bold text-slate-400 uppercase tracking-widest">Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù„Ù…ÙŠ</h2>
                <span class="text-[9px] bg-slate-800 px-2 py-1 rounded text-slate-500 font-mono" id="log-count">00/00</span>
            </header>
            
            <div id="lab-log" class="flex-1 space-y-4 overflow-y-auto pr-2 custom-scroll text-[11px]">
                <!-- Log entries -->
            </div>

            <div class="mt-6 pt-6 border-t border-slate-800">
                <div class="p-4 bg-emerald-500/5 border border-emerald-500/10 rounded-2xl">
                    <p class="text-[10px] text-emerald-400 font-medium leading-relaxed">
                        <span class="font-bold">Ù†ØµÙŠØ­Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø±:</span>
                        ØªØ£ÙƒØ¯ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒØ§Ø´Ù Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„ØªØ³Ø®ÙŠÙ† Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø¯Ù‚ÙŠÙ‚Ø© ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø®ØªØ²Ø§Ù„.
                    </p>
                </div>
            </div>
        </aside>
    </div>

    <script>
        // Full Data from the provided manual
        const DATA = {
            samples: [
                { id: 'glu', name: 'Ø¬Ù„ÙˆÙƒÙˆØ²', type: 'Ø³ÙƒØ± Ø£Ø­Ø§Ø¯ÙŠ (Ø£Ù„Ø¯ÙˆØ²)', formula: 'Câ‚†Hâ‚â‚‚Oâ‚†', info: 'Ø³ÙƒØ± Ù…Ø®ØªØ²Ù„ ÙŠØ¹Ø·ÙŠ Ù†ØªÙŠØ¬Ø© Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© Ø³Ø±ÙŠØ¹Ø©.' },
                { id: 'fru', name: 'ÙØ±ÙƒØªÙˆØ²', type: 'Ø³ÙƒØ± Ø£Ø­Ø§Ø¯ÙŠ (ÙƒÙŠØªÙˆØ²)', formula: 'Câ‚†Hâ‚â‚‚Oâ‚†', info: 'Ø³ÙƒØ± ÙƒÙŠØªÙˆÙ†ÙŠ ÙŠØªÙØ§Ø¹Ù„ Ø¨Ø³Ø±Ø¹Ø© Ù…Ø¹ ÙƒØ§Ø´Ù Ø³Ù„ÙŠÙˆØ§Ù†ÙˆÙ.' },
                { id: 'xyl', name: 'Ø²Ø§ÙŠÙ„ÙˆØ²', type: 'Ø³ÙƒØ± Ø®Ù…Ø§Ø³ÙŠ (Ø¨Ù†ØªÙˆØ²)', formula: 'Câ‚…Hâ‚â‚€Oâ‚…', info: 'Ø³ÙƒØ± Ø®Ù…Ø§Ø³ÙŠ ÙŠØ¹Ø·ÙŠ Ù„ÙˆÙ†Ø§Ù‹ Ù…Ù…ÙŠØ²Ø§Ù‹ Ù…Ø¹ ÙƒØ§Ø´Ù Ø¨ÙŠØ§Ù„.' },
                { id: 'suc', name: 'Ø³ÙƒØ±ÙˆØ²', type: 'Ø³ÙƒØ± Ø«Ù†Ø§Ø¦ÙŠ', formula: 'Câ‚â‚‚Hâ‚‚â‚‚Oâ‚â‚', info: 'Ø³ÙƒØ± ØºÙŠØ± Ù…Ø®ØªØ²Ù„ ÙŠØªØ·Ù„Ø¨ ØªØ­Ù„Ù„Ø§Ù‹ Ù…Ø§Ø¦ÙŠØ§Ù‹ Ù„ÙŠØ¹Ø·ÙŠ Ù†ØªØ§Ø¦Ø¬ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©.' },
                { id: 'mal', name: 'Ù…Ø§Ù„ØªÙˆØ²', type: 'Ø³ÙƒØ± Ø«Ù†Ø§Ø¦ÙŠ Ù…Ø®ØªØ²Ù„', formula: 'Câ‚â‚‚Hâ‚‚â‚‚Oâ‚â‚', info: 'ÙŠØªÙƒÙˆÙ† Ù…Ù† ÙˆØ­Ø¯ØªÙŠ Ø¬Ù„ÙˆÙƒÙˆØ²ØŒ Ù…Ø®ØªØ²Ù„ Ø¨Ø¨Ø·Ø¡ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ø±ÙÙˆÙŠØ¯.' },
                { id: 'sta', name: 'Ù†Ø´Ø£', type: 'Ø³ÙƒØ± Ù…ØªØ¹Ø¯Ø¯', formula: '(Câ‚†Hâ‚â‚€Oâ‚…)n', info: 'Ø¨ÙˆÙ„ÙŠÙ…Ø± Ù…Ø¹Ù‚Ø¯ØŒ ÙŠØªÙØ§Ø¹Ù„ Ø­ØµØ±ÙŠØ§Ù‹ Ù…Ø¹ Ø§Ù„ÙŠÙˆØ¯.' }
            ],
            reagents: [
                { id: 'mol', name: 'ÙƒØ§Ø´Ù Ù…ÙˆÙ„Ø´', color: '#a855f7', needsHeat: false, desc: 'ÙƒØ§Ø´Ù Ø¹Ø§Ù… Ù„ÙƒÙ„ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª.' },
                { id: 'ben', name: 'ÙƒØ§Ø´Ù Ø¨Ù†Ø¯ÙƒØª', color: '#3b82f6', needsHeat: true, desc: 'Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ø³ÙƒØ±ÙŠØ§Øª Ø§Ù„Ù…Ø®ØªØ²Ù„Ø©.' },
                { id: 'bar', name: 'ÙƒØ§Ø´Ù Ø¨Ø§Ø±ÙÙˆÙŠØ¯', color: '#60a5fa', needsHeat: true, desc: 'Ù„Ù„ØªÙ…ÙŠÙŠØ² Ø¨ÙŠÙ† Ø§Ù„Ø³ÙƒØ± Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠ ÙˆØ§Ù„Ø«Ù†Ø§Ø¦ÙŠ.' },
                { id: 'sel', name: 'ÙƒØ§Ø´Ù Ø³Ù„ÙŠÙˆØ§Ù†ÙˆÙ', color: '#fbbf24', needsHeat: true, desc: 'Ù„Ù„ØªÙ…ÙŠÙŠØ² Ø¨ÙŠÙ† Ø§Ù„Ø£Ù„Ø¯ÙˆØ² ÙˆØ§Ù„ÙƒÙŠØªÙˆØ².' },
                { id: 'bia', name: 'ÙƒØ§Ø´Ù Ø¨ÙŠØ§Ù„', color: '#f59e0b', needsHeat: true, desc: 'Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ø³ÙƒØ±ÙŠØ§Øª Ø§Ù„Ø®Ù…Ø§Ø³ÙŠØ©.' },
                { id: 'iod', name: 'Ù…Ø­Ù„ÙˆÙ„ Ø§Ù„ÙŠÙˆØ¯', color: '#78350f', needsHeat: false, desc: 'Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ù†Ø´Ø£.' }
            ]
        };

        let state = {
            sample: null,
            reagent: null,
            isHeating: false,
            heatTime: 0,
            isHydrolyzed: false,
            logs: []
        };

        // Initialize Inventory
        function initInventory() {
            const sGrid = document.getElementById('samples-grid');
            const rGrid = document.getElementById('reagents-grid');

            sGrid.innerHTML = DATA.samples.map(s => `
                <button onclick="pickSample('${s.id}')" class="text-right p-3 bg-white/5 border border-white/5 rounded-xl hover:border-emerald-500/40 transition group">
                    <div class="text-[11px] font-bold group-hover:text-emerald-400 transition-colors">${s.name}</div>
                    <div class="text-[9px] text-slate-500">${s.type}</div>
                </button>
            `).join('');

            rGrid.innerHTML = DATA.reagents.map(r => `
                <button onclick="addReagent('${r.id}')" class="text-right p-3 bg-white/5 border border-white/5 rounded-xl hover:border-blue-500/40 transition group">
                    <div class="text-[11px] font-bold group-hover:text-blue-400 transition-colors">${r.name}</div>
                    <div class="text-[9px] text-slate-500">${r.needsHeat ? 'ÙŠØªØ·Ù„Ø¨ ØªØ³Ø®ÙŠÙ†' : 'ØªÙØ§Ø¹Ù„ ÙÙˆØ±ÙŠ'}</div>
                </button>
            `).join('');
        }

        function pickSample(id) {
            resetLab();
            state.sample = DATA.samples.find(s => s.id === id);
            
            // Visuals
            document.getElementById('layer-sample').style.height = '30%';
            const label = document.getElementById('tube-label');
            label.innerText = state.sample.name;
            label.style.opacity = '1';
            
            updateInstruction(`ØªÙ… ÙˆØ¶Ø¹ Ø¹ÙŠÙ†Ø© ${state.sample.name} ÙÙŠ Ø§Ù„Ø£Ù†Ø¨ÙˆØ¨. Ø§Ø®ØªØ± ÙƒØ§Ø´ÙØ§Ù‹ Ø§Ù„Ø¢Ù†.`);
            addToLog(`ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø¹ÙŠÙ†Ø© Ù…Ù† ${state.sample.name}.`, 'info');
        }

        function addReagent(id) {
            if(!state.sample) return updateInstruction("Ø§Ø®ØªØ± Ø¹ÙŠÙ†Ø© Ø£ÙˆÙ„Ø§Ù‹!");
            
            state.reagent = DATA.reagents.find(r => r.id === id);
            const rLayer = document.getElementById('layer-reagent');
            rLayer.style.height = '60%';
            rLayer.style.backgroundColor = state.reagent.color;
            
            addToLog(`Ø¥Ø¶Ø§ÙØ© ${state.reagent.name} Ù„Ù„Ø£Ù†Ø¨ÙˆØ¨.`, 'chem');

            if(state.reagent.id === 'mol') {
                // Special visual for Molisch (adding H2SO4)
                updateInstruction("Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø­Ù…Ø¶ Ø§Ù„ÙƒØ¨Ø±ÙŠØªÙŠÙƒ Ø§Ù„Ù…Ø±ÙƒØ² Ø¨Ø­Ø°Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯Ø§Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ...");
                setTimeout(() => {
                    document.getElementById('molisch-ring').style.opacity = '1';
                    checkReaction();
                }, 2000);
            } else if(!state.reagent.needsHeat) {
                checkReaction();
            } else {
                updateInstruction(`ÙƒØ§Ø´Ù ${state.reagent.name} ÙŠØªØ·Ù„Ø¨ ØªØ³Ø®ÙŠÙ†Ø§Ù‹ ÙÙŠ Ø­Ù…Ø§Ù… Ù…Ø§Ø¦ÙŠ.`);
            }
        }

        function applyHeat() {
            if(!state.reagent) return updateInstruction("Ø£Ø¶Ù Ø§Ù„ÙƒØ§Ø´Ù Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ø®ÙŠÙ†.");
            if(state.isHeating) return;

            state.isHeating = true;
            document.getElementById('burner-device').classList.add('burner-active');
            document.getElementById('bubble-container').style.display = 'block';
            createBubbles();
            
            updateInstruction("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø®ÙŠÙ†... Ù†Ø±Ø§Ù‚Ø¨ ØªØºÙŠØ± Ø§Ù„Ù„ÙˆÙ†.");
            
            let timer = 0;
            const interval = setInterval(() => {
                timer += 1;
                state.heatTime = timer;
                if(timer >= 5) {
                    clearInterval(interval);
                    checkReaction();
                    stopHeat();
                }
            }, 1000);
        }

        function stopHeat() {
            state.isHeating = false;
            document.getElementById('burner-device').classList.remove('burner-active');
            document.getElementById('bubble-container').style.display = 'none';
        }

        function startHydrolysis() {
            if(!state.sample) return;
            updateInstruction("Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© HCl ÙˆØ§Ù„ØªØ³Ø®ÙŠÙ† Ù„Ù„ØªØ­Ù„Ù„ Ø§Ù„Ù…Ø§Ø¦ÙŠ...");
            
            setTimeout(() => {
                state.isHydrolyzed = true;
                addToLog("Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù„Ù„ Ø§Ù„Ù…Ø§Ø¦ÙŠ Ù„Ù„Ø³ÙƒØ±ÙˆØ²/Ø§Ù„Ù†Ø´Ø£ Ø¥Ù„Ù‰ Ø³ÙƒØ±ÙŠØ§Øª Ø£Ø­Ø§Ø¯ÙŠØ©.", 'warn');
                updateInstruction("Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù„Ù„. Ø§Ù„Ø¹ÙŠÙ†Ø© Ø§Ù„Ø¢Ù† ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø³ÙƒØ±ÙŠØ§Øª Ø£Ø­Ø§Ø¯ÙŠØ©.");
            }, 3000);
        }

        function checkReaction() {
            const sid = state.sample.id;
            const rid = state.reagent.id;
            let result = { pos: false, color: '', obs: '', desc: '' };

            switch(rid) {
                case 'mol':
                    result = { pos: true, color: 'rgba(147, 51, 234, 0.4)', obs: 'ØªÙƒÙˆÙ† Ø­Ù„Ù‚Ø© Ø¨Ù†ÙØ³Ø¬ÙŠØ©', desc: 'ÙŠØ¯Ù„ Ø¹Ù„Ù‰ ÙˆØ¬ÙˆØ¯ ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª (ØªÙƒÙˆÙ† Ø§Ù„ÙØ±ÙÙˆØ±Ø§Ù„).' };
                    break;
                
                case 'ben':
                    if(sid === 'glu' || sid === 'fru' || sid === 'xyl' || sid === 'mal' || state.isHydrolyzed) {
                        result = { pos: true, color: '#ea580c', obs: 'Ø±Ø§Ø³Ø¨ Ø£Ø­Ù…Ø± Ø·ÙˆØ¨ÙŠ', desc: 'ÙˆØ¬ÙˆØ¯ Ø³ÙƒØ± Ù…Ø®ØªØ²Ù„ (Ø§Ø®ØªØ²Ø§Ù„ Ø£ÙŠÙˆÙ†Ø§Øª Ø§Ù„Ù†Ø­Ø§Ø³ÙŠÙƒ).' };
                    } else {
                        result = { pos: false, color: '#3b82f6', obs: 'Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ù‚', desc: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³ÙƒØ± Ù…Ø®ØªØ²Ù„ (Ø§Ù„Ø³ÙƒØ±ÙˆØ² ÙˆØ§Ù„Ù†Ø´Ø£ Ø³Ù„Ø¨ÙŠ).' };
                    }
                    break;

                case 'iod':
                    if(sid === 'sta' && !state.isHydrolyzed) {
                        result = { pos: true, color: '#1e1b4b', obs: 'Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ø¯Ø§ÙƒÙ†', desc: 'ØªÙƒÙˆÙ† Ù…Ø¹Ù‚Ø¯ Ø§Ù„ÙŠÙˆØ¯ Ù…Ø¹ Ø§Ù„Ø£Ù…ÙŠÙ„ÙˆØ².' };
                    } else {
                        result = { pos: false, color: '#78350f', obs: 'Ù„ÙˆÙ† Ø§Ù„ÙŠÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ', desc: 'Ø³Ù„Ø¨ÙŠ (Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø£ Ù…Ø¹Ù‚Ø¯).' };
                    }
                    break;

                case 'bar':
                    if((sid === 'glu' || sid === 'fru' || sid === 'xyl' || state.isHydrolyzed)) {
                        result = { pos: true, color: '#991b1b', obs: 'Ø±Ø§Ø³Ø¨ Ø£Ø­Ù…Ø± (Ø³Ø±ÙŠØ¹)', desc: 'Ø³ÙƒØ± Ø£Ø­Ø§Ø¯ÙŠ Ù…Ø®ØªØ²Ù„.' };
                    } else if(sid === 'mal') {
                        result = { pos: false, color: '#3b82f6', obs: 'ØªÙØ§Ø¹Ù„ Ø¨Ø·ÙŠØ¡ Ø¬Ø¯Ø§Ù‹', desc: 'Ø§Ù„Ø³ÙƒØ±ÙŠØ§Øª Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© Ù„Ø§ ØªØªÙØ§Ø¹Ù„ Ø¨Ø³Ø±Ø¹Ø© Ù…Ø¹ Ù‡Ø°Ø§ Ø§Ù„ÙƒØ§Ø´Ù.' };
                    } else {
                        result = { pos: false, color: '#60a5fa', obs: 'Ù„Ø§ ØªÙØ§Ø¹Ù„', desc: 'Ø³Ù„Ø¨ÙŠ.' };
                    }
                    break;

                case 'sel':
                    if(sid === 'fru' || sid === 'suc' || state.isHydrolyzed) {
                        result = { pos: true, color: '#dc2626', obs: 'Ù„ÙˆÙ† Ø£Ø­Ù…Ø± ÙƒØ±Ø²ÙŠ', desc: 'ÙˆØ¬ÙˆØ¯ Ø³ÙƒØ± ÙƒÙŠØªÙˆÙ†ÙŠ (Ø§Ù„ÙƒÙŠØªÙˆØ²Ø§Øª ØªØªÙØ§Ø¹Ù„ Ø£Ø³Ø±Ø¹).' };
                    } else {
                        result = { pos: false, color: '#fef3c7', obs: 'Ù„ÙˆÙ† Ø£ØµÙØ± Ø´Ø§Ø­Ø¨', desc: 'Ø§Ù„Ø£Ù„Ø¯ÙˆØ²Ø§Øª ØªØªÙØ§Ø¹Ù„ Ø¨Ø¨Ø·Ø¡ Ø´Ø¯ÙŠØ¯.' };
                    }
                    break;

                case 'bia':
                    if(sid === 'xyl') {
                        result = { pos: true, color: '#065f46', obs: 'Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± Ù…Ø²Ø±Ù‚', desc: 'ÙˆØ¬ÙˆØ¯ Ø³ÙƒØ± Ø®Ù…Ø§Ø³ÙŠ (Ø¨Ù†ØªÙˆØ²).' };
                    } else {
                        result = { pos: false, color: '#78350f', obs: 'Ù„ÙˆÙ† Ø¨Ù†ÙŠ/Ø£ØµÙØ±', desc: 'Ø³ÙƒØ± Ø³Ø¯Ø§Ø³ÙŠ (Ù‡ÙƒØ³ÙˆØ²).' };
                    }
                    break;
            }

            displayResult(result);
        }

        function displayResult(res) {
            const rLayer = document.getElementById('layer-reaction');
            rLayer.style.height = '90%';
            rLayer.style.backgroundColor = res.color;

            const panel = document.getElementById('result-panel');
            panel.style.opacity = '1';
            panel.style.transform = 'translateY(0)';

            document.getElementById('res-title').innerText = state.reagent.name;
            document.getElementById('res-desc').innerText = res.desc;
            document.getElementById('res-struct').innerText = state.sample.formula;
            document.getElementById('res-obs').innerText = res.obs;
            
            const badge = document.getElementById('res-badge');
            badge.innerText = res.pos ? 'Ø¥ÙŠØ¬Ø§Ø¨ÙŠ (Positive)' : 'Ø³Ù„Ø¨ÙŠ (Negative)';
            badge.className = res.pos ? 'px-2 py-0.5 rounded text-[9px] font-bold bg-emerald-500/20 text-emerald-400' : 'px-2 py-0.5 rounded text-[9px] font-bold bg-red-500/20 text-red-400';

            addToLog(`Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${res.obs}`, res.pos ? 'pos' : 'neg');
        }

        function createBubbles() {
            const container = document.getElementById('bubble-container');
            container.innerHTML = '';
            for(let i=0; i<20; i++) {
                const b = document.createElement('div');
                b.className = 'bubble';
                b.style.left = Math.random() * 100 + '%';
                b.style.width = b.style.height = (Math.random() * 8 + 2) + 'px';
                b.style.animationDelay = Math.random() * 1 + 's';
                container.appendChild(b);
            }
        }

        function updateInstruction(text) {
            document.getElementById('instruction-text').innerText = text;
        }

        function resetLab() {
            state = { sample: null, reagent: null, isHeating: false, heatTime: 0, isHydrolyzed: false, logs: state.logs };
            document.getElementById('layer-sample').style.height = '0';
            document.getElementById('layer-reagent').style.height = '0';
            document.getElementById('layer-reaction').style.height = '0';
            document.getElementById('molisch-ring').style.opacity = '0';
            document.getElementById('tube-label').style.opacity = '0';
            document.getElementById('result-panel').style.opacity = '0';
            document.getElementById('result-panel').style.transform = 'translateY(100%)';
            stopHeat();
        }

        function addToLog(msg, type) {
            const log = document.getElementById('lab-log');
            const entry = document.createElement('div');
            let color = 'text-slate-400';
            if(type === 'pos') color = 'text-emerald-400';
            if(type === 'neg') color = 'text-red-400';
            if(type === 'warn') color = 'text-blue-400';
            
            entry.className = `p-3 rounded-xl bg-white/5 border-r-2 border-slate-700 ${color}`;
            entry.innerHTML = `
                <div class="flex justify-between mb-1 opacity-50 text-[8px]">
                    <span>${new Date().toLocaleTimeString('ar-EG')}</span>
                    <span>#${log.children.length + 1}</span>
                </div>
                ${msg}
            `;
            log.prepend(entry);
            document.getElementById('log-count').innerText = `${log.children.length}/20`;
        }

        initInventory();
    </script>
</body>
</html>

